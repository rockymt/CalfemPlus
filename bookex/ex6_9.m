% example ex6_9data
%----------------------------------------------------------------
% LAST MODIFIED: Yan LIU  2016-04-06
% Copyright (c)  School of Civil Engineering.
%                Ludong University
%-------------------------------------------------------------

% REFERENCES
% 
%----------------------------------------------------------------
clear
%-----------Global coordinate matrix-----------------------------
%-----------data from ansys-------------------------------------
 Coord=[ 
 1  0.0000000000000E+00 -6.0000000000000E+00
 2  5.0000000000000E+00 -6.0000000000000E+00
 3  2.5000000000000E+00 -6.0000000000000E+00
 4  1.2803687993290E+00 -1.5364425591948E+00
 5  3.7601229331097E+00 -4.5121475197316E+00
 6  2.5202458662193E+00 -3.0242950394632E+00
 7  0.0000000000000E+00 -2.0000000000000E+00
 8  6.8085052745676E-01 -1.8805431553841E+00
 9  0.0000000000000E+00 -4.6666666666667E+00
10  0.0000000000000E+00 -3.3333333333333E+00
11  1.2872336849396E+00 -3.2536954369170E+00
12  1.8936168424541E+00 -4.6268477184556E+00
13  5.0000000000000E+00  6.0000000000000E+00
14  0.0000000000000E+00  6.0000000000000E+00
15  2.5000000000000E+00  6.0000000000000E+00
16  0.0000000000000E+00  2.0000000000000E+00
17  0.0000000000000E+00  4.6666666666667E+00
18  0.0000000000000E+00  3.3333333333333E+00
19  1.2803687993290E+00  1.5364425591948E+00
20  6.8085052750716E-01  1.8805431553658E+00
21  3.7601229331097E+00  4.5121475197316E+00
22  2.5202458662193E+00  3.0242950394632E+00
23  1.2872336850055E+00  3.2536954369106E+00
24  1.8936168425031E+00  4.6268477184553E+00
25  5.0000000000000E+00  0
26  5.0000000000000E+00 -3.0000000000000E+00
27  2.0000000000000E+00  0
28  4.0000000000000E+00  0
29  3.0000000000000E+00  0
30  1.8111788424400E+00 -8.4831079251520E-01
31  2.8741192282941E+00 -1.5655405283528E+00
32  3.9370596141475E+00 -2.2827702641811E+00
33  5.0000000000000E+00  3.0000000000000E+00
34  1.8111788424400E+00  8.4831079251520E-01
35  2.8741192282941E+00  1.5655405283528E+00
36  3.9370596141475E+00  2.2827702641811E+00];
 
%-----------Element connectivity matrix--------------------------	   
 El = [   
  1        4       11        6 
  2        4        8       11 
  3        8       10       11 
  4        8        7       10 
  5        6       12        5 
  6        6       11       12 
  7       11        9       12 
  8       11       10        9 
  9        5        3        2 
 10        5       12        3 
 11       12        1        3 
 12       12        9        1 
 13       20       18       16 
 14       20       23       18 
 15       19       23       20 
 16       19       22       23 
 17       23       17       18 
 18       23       24       17 
 19       22       24       23 
 20       22       21       24 
 21       24       14       17 
 22       24       15       14 
 23       21       15       24 
 24       21       13       15 
 25       30       29       27 
 26       30       31       29 
 27        4       31       30 
 28        4        6       31 
 29       31       28       29 
 30       31       32       28 
 31        6       32       31 
 32        6        5       32 
 33       32       25       28 
 34       32       26       25 
 35        5       26       32 
 36        5        2       26 
 37       19       35       22 
 38       19       34       35 
 39       34       29       35 
 40       34       27       29 
 41       22       36       21 
 42       22       35       36 
 43       35       28       36 
 44       35       29       28 
 45       21       33       13 
 46       21       36       33 
 47       36       25       33 
 48       36       28       25 ];
%-----------Element type----------------------------------------
 ElTp = 'plante';

%-------- Extract topology matrix Edof &-----------------------
%-------- element coordinate matrices -------------------------
 [EDof,GDof,Ex,Ey]=ExtractElInfo(El,ElTp,Coord(:,2:end));	   
 
%----- Draw the fe-mesh as a check of the model -----------------
 figure(1)
 hold on;
 eldraw2(Ex,Ey,[1 3 1]);     
 
%----- Stiffness matrix K and load vector f ---------------------
 nDof=max(max(GDof));
 K=sparse(nDof,nDof);
 f=zeros(nDof,1);

%----- Element properties  --------------------------------------
 ptype=1; thick=0.5;
 ep=[ptype thick];
 E=30e6; v=0.25;
 D=hooke(ptype,E,v);
 
%--------------------traction force------------------------
 % TBd=[1 2 6 0 -400 0 -400;
      % 1 6 5 0 -400 0 -400];
 TBd=[2 1 3 -400 0 -400 0;
      2 3 2 -400 0 -400 0];
 for ii=1:size(TBd,1)
     f=plant2T2f(f,TBd(ii,:),GDof,Coord,thick);
 end
%----- Assemble Ke into K ---------------------------------------

 for i = 1:size(El,1)
   Ke=plante(Ex(i,:),Ey(i,:),ep,D); 
   [K]=assem(EDof(i,:),K,Ke);
 end
% spy(K)
%----- Solve the system of equations ----------------------------

 bc= [GDof(14,1) 0; GDof(14,2) 0;
      GDof(15,1) 0; GDof(15,2) 0;
	  GDof(13,1) 0; GDof(13,2) 0];   
 [a,r]=solveq(K,f,bc);

%----- Element forces -------------------------------------------
 for i = 1:size(El,1)
	 ed(i,:)=extract(EDof(i,:),a);
	 [es(i,:) et(i,:)]=plants(Ex(i,:),Ey(i,:),ep,D,ed(i,:));
 end
 
 figure(1);
 esyy=[es(:,2),es(:,2),es(:,2)];
 fill(Ex',Ey',esyy');
 axis equal;
 colorbar;
%-----Nodal Values from Known Constant Element Values-------------
 figure(2);
 esy=plantefit(El,Coord,es(:,2))
 fill(Ex',Ey',esy');
 axis equal;
 colorbar;

%----- Draw deformed frame ---------------------------------------
 figure(3)
 hold on;
 sfac=scalfact2(Ex(3,:),Ey(3,:),ed(3,:),0.2);
 for i = 1:size(El,1)
     eldraw2(Ex(i,:),Ey(i,:),[2 1 0]);	 
	 eldisp2(Ex(i,:),Ey(i,:),ed(i,:),[1 2 1],sfac);
 end
 %pltscalb2(sfac,[1e-1 60 0]);
 title('displacements')
 
 