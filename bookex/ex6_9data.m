% example ex6_9data
%----------------------------------------------------------------
% LAST MODIFIED: Yan LIU  2016-04-06
% Copyright (c)  School of Civil Engineering.
%                Ludong University
%-------------------------------------------------------------

% REFERENCES
% 
%----------------------------------------------------------------

%-----------Global coordinate matrix-----------------------------
%-----------data from ansys-------------------------------------
 Coord=[ 1  0.0000000000000E+00 4.0000000000000E+00
 2  0.0000000000000E+00 0
 3  0.0000000000000E+00 2.6666666666667E+00
 4  0.0000000000000E+00 1.3333333333333E+00
 5  5.0000000000000E+00 0
 6  2.5000000000000E+00 0
 7  1.4142000000000E+00 4.5858000000000E+00
 8  3.8047333333333E+00 1.5286000000000E+00
 9  2.6094666666667E+00 3.0572000000000E+00
10  7.6536113002751E-01 4.1522497950070E+00
11  1.9217870433425E+00 1.3840832650023E+00
12  1.3435740866850E+00 2.7681665300047E+00
13  2.0000000000000E+00 6.0000000000000E+00
14  1.8477502049930E+00 5.2346388699725E+00
15  5.0000000000000E+00 6.0000000000000E+00
16  4.0000000000000E+00 6.0000000000000E+00
17  3.0000000000000E+00 6.0000000000000E+00
18  5.0000000000000E+00 3.0000000000000E+00
19  2.8985001366620E+00 4.4897592466483E+00
20  3.9492500683310E+00 3.7448796233242E+00
21  1.4142000000000E+00 7.4142000000000E+00
22  1.8477502049930E+00 6.7653611300275E+00
23  5.0000000000000E+00 1.2000000000000E+01
24  3.8047333333333E+00 1.0471400000000E+01
25  2.6094666666667E+00 8.9428000000000E+00
26  5.0000000000000E+00 9.0000000000000E+00
27  3.9492500683310E+00 8.2551203766758E+00
28  2.8985001366620E+00 7.5102407533517E+00
29  0.0000000000000E+00 8.0000000000000E+00
30  7.6536113002751E-01 7.8477502049930E+00
31  0.0000000000000E+00 1.2000000000000E+01
32  0.0000000000000E+00 1.0666666666667E+01
33  0.0000000000000E+00 9.3333333333333E+00
34  2.5000000000000E+00 1.2000000000000E+01
35  1.9217870433425E+00 1.0615916734998E+01
36  1.3435740866850E+00 9.2318334699953E+00];
 
%-----------Element connectivity matrix--------------------------	   
 El = [   1        8        6        5
   2        8       11        6
   3        9       11        8
   4        9       12       11
   5        7       12        9
   6        7       10       12
   7       11        2        6
   8       11        4        2
   9       12        4       11
  10       12        3        4
  11       10        3       12
  12       10        1        3
  13       14       17       13
  14       14       19       17
  15        7       19       14
  16        7        9       19
  17       19       16       17
  18       19       20       16
  19        9       20       19
  20        9        8       20
  21       20       15       16
  22       20       18       15
  23        8       18       20
  24        8        5       18
  25       24       26       23
  26       24       27       26
  27       25       27       24
  28       25       28       27
  29       21       28       25
  30       21       22       28
  31       27       15       26
  32       27       16       15
  33       28       16       27
  34       28       17       16
  35       22       17       28
  36       22       13       17
  37       31       35       34
  38       31       32       35
  39       32       36       35
  40       32       33       36
  41       33       30       36
  42       33       29       30
  43       34       24       23
  44       34       35       24
  45       35       25       24
  46       35       36       25
  47       36       21       25
  48       36       30       21];
%-----------Element type----------------------------------------
 ElTp = 'plante';

%-------- Extract topology matrix Edof &-----------------------
%-------- element coordinate matrices -------------------------
 [EDof,GDof,Ex,Ey]=ExtractElInfo(El,ElTp,Coord(:,2:end));	   
 
%----- Draw the fe-mesh as a check of the model -----------------
 figure(1)
 hold on;
 eldraw2(Ex,Ey,[1 3 1]);     
 
%----- Stiffness matrix K and load vector f ---------------------
 nDof=max(max(GDof));
 K=sparse(nDof,nDof);
 f=zeros(nDof,1);

%----- Element properties  --------------------------------------
 ptype=1; thick=0.5;
 ep=[ptype thick];
 E=30e6; v=0.25;
 D=hooke(ptype,E,v);
 
%--------------------traction force------------------------
 % TBd=[1 2 6 0 -400 0 -400;
      % 1 6 5 0 -400 0 -400];
 TBd=[2 2 6 -400 0 -400 0;
      2 6 5 -400 0 -400 0];
 f=plant2T2f(f,TBd,El,EDof,Ex,Ey,ep);
 
%----- Assemble Ke into K ---------------------------------------

 for i = 1:size(El,1)
   Ke=plante(Ex(i,:),Ey(i,:),ep,D); 
   [K]=assem(EDof(i,:),K,Ke);
 end
 spy(K)
%----- Solve the system of equations ----------------------------

 bc= [GDof(31,1) 0; GDof(31,2) 0;
      GDof(34,1) 0; GDof(34,2) 0;
	  GDof(23,1) 0; GDof(23,2) 0];   
 [a,r]=solveq(K,f,bc)

%----- Element forces -------------------------------------------
 for i = 1:size(El,1)
	 ed(i,:)=extract(EDof(i,:),a);
	 [es(i,:) et(i,:)]=plants(Ex(i,:),Ey(i,:),ep,D,ed(i,:));
 end
 
 esy=plantefit(El,Coord,es(:,2))

 fill(Ex',Ey',esy')
 axis equal
 colorbar
 %----- Draw deformed frame ---------------------------------------
 figure(2)
 hold on;
 sfac=scalfact2(Ex(3,:),Ey(3,:),ed(3,:),0.2);
 for i = 1:size(El,1)
     eldraw2(Ex(i,:),Ey(i,:),[2 1 0]);	 
	 eldisp2(Ex(i,:),Ey(i,:),ed(i,:),[1 2 1],sfac);
 end
 %pltscalb2(sfac,[1e-1 60 0]);
 title('displacements')
 
 